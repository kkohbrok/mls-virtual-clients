<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>MLS Virtual Clients</title>
<meta content="Konrad Kohbrok" name="author">
<meta content="Raphael Robert" name="author">
<meta content="
       This document describes a method that allows multiple MLS clients to emulate a
virtual MLS client. A virtual client allows multiple emulator clients to jointly
participate in an MLS group under a single leaf. Depending on the design of the
application, virtual clients can help hide metadata and improve performance. 
    " name="description">
<meta content="xml2rfc 3.18.2" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-kohbrok-mls-virtual-clients-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.18.2
    Python 3.10.12
    ConfigArgParse 1.7
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.3
    platformdirs 4.0.0
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.31.0
    setuptools 68.2.2
    six 1.16.0
    wcwidth 0.2.9
-->
<link href="draft-kohbrok-mls-virtual-clients.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">MVC</td>
<td class="right">November 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Kohbrok &amp; Robert</td>
<td class="center">Expires 20 May 2024</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-kohbrok-mls-virtual-clients-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2023-11-17" class="published">17 November 2023</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2024-05-20">20 May 2024</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">K. Kohbrok</div>
<div class="org">Phoenix R&amp;D</div>
</div>
<div class="author">
      <div class="author-name">R. Robert</div>
<div class="org">Phoenix R&amp;D</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">MLS Virtual Clients</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes a method that allows multiple MLS clients to emulate a
virtual MLS client. A virtual client allows multiple emulator clients to jointly
participate in an MLS group under a single leaf. Depending on the design of the
application, virtual clients can help hide metadata and improve performance.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 20 May 2024.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-client-emulation" class="internal xref">Client emulation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1" class="keepWithNext"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-example-protocol-flow" class="internal xref">Example protocol flow</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-ds-as-details" class="internal xref">DS/AS Details</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-agreement-on-generation-of-" class="internal xref">Agreement on/generation of key material</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="auto internal xref">3.4</a>.  <a href="#name-coordinating-virtual-client" class="internal xref">Coordinating virtual client operations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="auto internal xref">3.5</a>.  <a href="#name-possible-message-re-orderin" class="internal xref">Possible message re-ordering</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.6">
                <p id="section-toc.1-1.3.2.6.1"><a href="#section-3.6" class="auto internal xref">3.6</a>.  <a href="#name-adding-emulator-clients" class="internal xref">Adding emulator clients</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.7">
                <p id="section-toc.1-1.3.2.7.1"><a href="#section-3.7" class="auto internal xref">3.7</a>.  <a href="#name-sending-application-message" class="internal xref">Sending application messages</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.7.2.1">
                    <p id="section-toc.1-1.3.2.7.2.1.1"><a href="#section-3.7.1" class="auto internal xref">3.7.1</a>.  <a href="#name-challenge-based-application" class="internal xref">Challenge-based Application Messages</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.8">
                <p id="section-toc.1-1.3.2.8.1"><a href="#section-3.8" class="auto internal xref">3.8</a>.  <a href="#name-rotation-of-authentication-" class="internal xref">Rotation of authentication key material</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-security-considerations" class="internal xref">Security considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-privacy-considerations" class="internal xref">Privacy considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-performance-considerations" class="internal xref">Performance considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-smaller-trees" class="internal xref">Smaller Trees</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-fewer-blanks" class="internal xref">Fewer blanks</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-emulation-costs" class="internal xref">Emulation costs</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The MLS protocol facilitates communication between clients, where in an MLS
group, each client is represented by the leaf to which it holds the private key
material. In this document, we propose the notion of a virtual client that is
jointly emulated by a group of emulator clients, where each emulator client
holds the key material necessary to act as the virtual client.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">Depending on the use case, the use of virtual clients can lead to performance
increases and hide metadata from the DS and other group members. On the other
hand, it introduces complexity and additional operational requirements.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">We discuss technical challenges and propose a concrete scheme that allows a
group of clients to emulate a virtual client that can participate in one or more
MLS groups.<a href="#section-1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="terminology">
<section id="section-2">
      <h2 id="name-terminology">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<ul class="normal">
<li class="normal" id="section-2-1.1">
          <p id="section-2-1.1.1">Client: An MLS client<a href="#section-2-1.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-1.2">
          <p id="section-2-1.2.1">Virtual Client: A client the key material of which is held by one or more
(other) clients.<a href="#section-2-1.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-1.3">
          <p id="section-2-1.3.1">Emulator Client: A client that collaborates with other emulator clients in
emulating a virtual client. Emulator clients can themselves be virtual
clients.<a href="#section-2-1.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-2-2">TODO: Terminology is up for debate. We’ve sometimes called this “user trees”,
but since there are other use cases, we should choose a more neutral name. For
now, it’s virtual client emulation.<a href="#section-2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-emulation">
<section id="section-3">
      <h2 id="name-client-emulation">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-client-emulation" class="section-name selfRef">Client emulation</a>
      </h2>
<p id="section-3-1">To emulate a virtual client, the emulator clients need to agree on the key
material held by the virtual client and coordinate the actions taken by the
client in any group of which it is a member. The obvious way for the emulator
clients to achieve both of these tasks is to create an MLS group which we call
the emulation group. In contrast, we call any group that the virtual client is a
member of a higher-level group.<a href="#section-3-1" class="pilcrow">¶</a></p>
<div id="example-protocol-flow">
<section id="section-3.1">
        <h3 id="name-example-protocol-flow">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-example-protocol-flow" class="section-name selfRef">Example protocol flow</a>
        </h3>
<p id="section-3.1-1">TODO: Go through a full flow, where both sender and receiver are virtual
clients. Include both communication in the higher-level group and in the
emulation group.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="dsas-details">
<section id="section-3.2">
        <h3 id="name-ds-as-details">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-ds-as-details" class="section-name selfRef">DS/AS Details</a>
        </h3>
<p id="section-3.2-1">Virtual client emulation should be largely agnostic to specific details of the
AS and DS of the application. However, a few conditions must be met.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-2.1">
            <p id="section-3.2-2.1.1">Access control: All emulator clients must be able to act as the virtual
client, including, for example, queue access and KeyPackage upload<a href="#section-3.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-2.2">
            <p id="section-3.2-2.2.1">Queue compatibility: The queue system must allow all emulator clients to
retrieve messages for the virtual clients. (Although workarounds like one
emulator client retrieving messages and then sending them to the emulation
group are possible.)<a href="#section-3.2-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="agreement-ongeneration-of-key-material">
<section id="section-3.3">
        <h3 id="name-agreement-on-generation-of-">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-agreement-on-generation-of-" class="section-name selfRef">Agreement on/generation of key material</a>
        </h3>
<p id="section-3.3-1">Agreement on key material is one of the primary features of MLS and the emulator
clients can simply export secrets from the emulation group to provide the
randomness for all key material generated by the virtual client throughout its
lifetime, especially any MLS-specific key material such as leaf encryption keys
or init keys.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">This leaves the generation of authentication key material, which can also be
based on exporters from the emulation group, but which otherwise depends on the
design of the AS. In the context of virtual clients, one should note, however,
that the specifics of the AS can influence how well the virtual client hides the
metadata of the underlying emulator clients.<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<p id="section-3.3-3">TODO: Be more explicit on how the randomness is exported.<a href="#section-3.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="coordinating-virtual-client-operations">
<section id="section-3.4">
        <h3 id="name-coordinating-virtual-client">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-coordinating-virtual-client" class="section-name selfRef">Coordinating virtual client operations</a>
        </h3>
<p id="section-3.4-1">Generally, emulator clients should coordinate the actions taken by the virtual
client. This is, for example, to prevent multiple emulator clients from
uploading KeyPackages simultaneously.<a href="#section-3.4-1" class="pilcrow">¶</a></p>
<p id="section-3.4-2">However, emulator clients do not have to coordinate all actions taken by the
virtual client. Specifically, commits in a single higher-level group can be sent
without the risk of desynchronization between the emulator clients, as the
group’s DS will enforce message ordering. Coordination is thus required for
non-commit messages (specifically proposals and application messages), as well
as actions that affect more than one higher-level group (such as credential
updates, depending on the AS).<a href="#section-3.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="possible-message-re-ordering">
<section id="section-3.5">
        <h3 id="name-possible-message-re-orderin">
<a href="#section-3.5" class="section-number selfRef">3.5. </a><a href="#name-possible-message-re-orderin" class="section-name selfRef">Possible message re-ordering</a>
        </h3>
<p id="section-3.5-1">One difficulty in coordinating the use of randomness exported from the emulation
group is that we cannot assume that messages arrive in order. For example, if an
emulator client sends an Update in the emulation group and then immediately
exports randomness from the new epoch to have the virtual client create an
update in the higher-level group, then other emulator clients might receive the
update in the higher-level group first. Since they have not yet received the
other update, they will have to wait for the emulation group update before they
can process it. Depending on the DS, this may or may not require specific care.<a href="#section-3.5-1" class="pilcrow">¶</a></p>
<p id="section-3.5-2">TODO: Add a recommendation here, maybe to extract randomness only from emulation
group epochs that are at least X seconds old, which in turn requires clients to
keep around randomness, thus potentially compromising FS somewhat.<a href="#section-3.5-2" class="pilcrow">¶</a></p>
<p id="section-3.5-3">In addition, since the epochs in the emulation group and higher level group are
not necessarily correlated, i.e. an emulator client performing an update in the
higher level group might not at the same time perform an update in the emulation
group. The emulator client performing the update in the higher level group thus
has to signal the other emulator clients which emulation group epoch to use to
export the randomness.<a href="#section-3.5-3" class="pilcrow">¶</a></p>
<p id="section-3.5-4">TODO: Find a good way to signal this to the rest of the emulation group.
Options:<a href="#section-3.5-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.5-5.1">
            <p id="section-3.5-5.1.1">AAD of the higher-level group update (leaks metadata to higher-level groups,
could collide with application-level use of AAD)<a href="#section-3.5-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.5-5.2">
            <p id="section-3.5-5.2.1">Application message to emulation group (subject to message re-ordering as
described above)<a href="#section-3.5-5.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.5-5.3">
            <p id="section-3.5-5.3.1">LeafNode extension (leaks metadata to higher-level groups)<a href="#section-3.5-5.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="adding-emulator-clients">
<section id="section-3.6">
        <h3 id="name-adding-emulator-clients">
<a href="#section-3.6" class="section-number selfRef">3.6. </a><a href="#name-adding-emulator-clients" class="section-name selfRef">Adding emulator clients</a>
        </h3>
<p id="section-3.6-1">If a client is added to the emulation group, it has to be provisioned with the
private key material and the group states of all higher-level groups. While the
latter might be able to be provisioned by the higher-level DS, the former has to
be provided by another emulator client.<a href="#section-3.6-1" class="pilcrow">¶</a></p>
<p id="section-3.6-2">The other emulator client can provide the secret key material used to derive all
key material relevant to the virtual client (higher-level group secrets,
KeyPackage secrets, etc.)<a href="#section-3.6-2" class="pilcrow">¶</a></p>
<p id="section-3.6-3">TODO: This means that all such key material must be derived in a well-separated
and forward-secure way. (See TODO above to specify further details on how to
derive key material for the virtual client.)<a href="#section-3.6-3" class="pilcrow">¶</a></p>
<p id="section-3.6-4">Since the new emulator client can only emulate the virtual client if it has
access to those secrets, it cannot join the emulation group via external commit,
except if said secrets are provided asynchronously.<a href="#section-3.6-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sending-application-messages">
<section id="section-3.7">
        <h3 id="name-sending-application-message">
<a href="#section-3.7" class="section-number selfRef">3.7. </a><a href="#name-sending-application-message" class="section-name selfRef">Sending application messages</a>
        </h3>
<p id="section-3.7-1">Open Question: Key material for encryption/decryption of application messages is
used only once. Since there is no ordering of application messages (per client)
on the DS, emulator clients could have the same virtual client send an
application message at the same time, both using the same key material. When
those messages arrive at a recipient, the recipient won’t be able to decrypt the
second message, because the recipient has already discarded the required key
material. How to avoid this? A few ideas:<a href="#section-3.7-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.7-2.1">
            <p id="section-3.7-2.1.1">Key generation allotments: Clients in the emulation group use the ratchet
generation modulo their leaf index in the emulation group. (Leaks metadata to
higher-level groups, potentially requires all other higher-level group members
to store lots of intermediary key generations, could confuse applications if
they derive message ordering from key generations, could make recipients think
that they missed messages)<a href="#section-3.7-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.7-2.2">
            <p id="section-3.7-2.2.1">More complex secret tree (or separate secret tree): Instead of a single
ratchet at the leaf of the secret tree, there is another tree with one ratchet
for each emulator client. (extra costs for PPRF, leaks metadata, requires an
extension, either an unsafe one (if the original secret tree is modified), or
a safe one that defines its own application message (if a new secret tree is
used))<a href="#section-3.7-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<div id="challenge-based-application-messages">
<section id="section-3.7.1">
          <h4 id="name-challenge-based-application">
<a href="#section-3.7.1" class="section-number selfRef">3.7.1. </a><a href="#name-challenge-based-application" class="section-name selfRef">Challenge-based Application Messages</a>
          </h4>
<p id="section-3.7.1-1">The MLS specification defines a method for sending application messages. To use
that method, senders and receivers must know to which ratchet tree leaf the
sending client belongs which precludes the possibility of group members sending
anonymously to the group; a property that can be desirable for some
applications. The method is designed with receivers in mind that process
application messages in roughly the order they were sent. Consequently,
receivers the method imposes significant computational and storage costs for
receivers that want skip several application messages to access a more recently
sent one directly. For example, skipping <code>j</code> application messages sent by the
same client requires at least <code>j</code> calls to <code>ExpandWithLable</code> and requires
storing <code>j</code> secrets for possible later use.<a href="#section-3.7.1-1" class="pilcrow">¶</a></p>
<p id="section-3.7.1-2">To better support anonymous sending and random-access processing of application
messages, the extension to <span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span> described in this section introduces an
alternate method for sending application messages called "challenge-based"
application messagees. The method does not require receivers know the senders
ratchet tree leaf. It also allows processing incoming application messages with
a cost independent of the order they are received in. The extension exclusively
uses the Safe Extension API of draft-03 of <span>[<a href="#I-D.draft-ietf-mls-extensions" class="cite xref">I-D.draft-ietf-mls-extensions</a>]</span>;
i.e. using that draft's terminology it is a "safe extension".<a href="#section-3.7.1-2" class="pilcrow">¶</a></p>
<p id="section-3.7.1-3">In comparison MLS's standard applcation messages, challenge-based application
messages are KDF.Nh - 4 bytes larger. Sending and receiving them require (at
most) KDF.Nh calls to ExpandWithLabel and storing one secret of size KDF.Nh
octets per such call. This holds for the receiver regardless of how many
previouse application messages from the same sender were skipped by the
receiver.<a href="#section-3.7.1-3" class="pilcrow">¶</a></p>
<p id="section-3.7.1-4">Challenge-based messages can be sent either in one of three modes:
random-access, private-anonymous or public-anonymous mode. Random-access mode
application message can be validated and decrypted at a cost independent of how
many messages tehe receiver has skipped. In adition, the two anonymous modes
omit any data that could reveal the senders leaf index, authenticating only that
 the sender is in the group. In the private-anonymous mode this can only be
verified by other group members. With the public-anonymous mode the group
membership of the sender can be verified by external (i.e. non-member) parties
such as a server acting as part of the DS. The anonymous modes come at a price
in terms of a slightly weaker flavour of post comporomise message authenticity
described in <a href="#security-considerations-for-anonymous-modes" class="auto internal xref">Section 3.7.1.8</a>. Applications can
send each new application message using a different mode which can be chosen
when sending.<a href="#section-3.7.1-4" class="pilcrow">¶</a></p>
<div id="challenge-selection">
<section id="section-3.7.1.1">
            <h5 id="name-challenge-selection">
<a href="#section-3.7.1.1" class="section-number selfRef">3.7.1.1. </a><a href="#name-challenge-selection" class="section-name selfRef">Challenge Selection</a>
            </h5>
<p id="section-3.7.1.1-1">To send an application message the sender must first sample a challenge. It is
crucial for application message confidentiality that challenges have high
entropy and are never used more than once. The following method for sampling
challenges ensures this by introducing sufficient entropy and guaranting that
two challenges can only ever be the same if they are sampled by the same sender,
 in the same epoch, for the same message generation using the same entropy.<a href="#section-3.7.1.1-1" class="pilcrow">¶</a></p>
<p id="section-3.7.1.1-2">For each epoch in which a client wants to send challenge-based application
messages it maintains a local uint32 message generation counter for the epoch.
The counter is initilized to 0 and incremented after each challenge is sampled.
If the counter wraps around to 0 then all subsequent attempts by the client to
send in the epoch MUST result in a failure.<a href="#section-3.7.1.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.7.1.1-3">
<pre>
uint32 generation;
</pre><a href="#section-3.7.1.1-3" class="pilcrow">¶</a>
</div>
<p id="section-3.7.1.1-4">To sample a challenge the sender first samples AEAD.Nk uniform random octets
called the challenge-seed. Next the they populate a ChallengeContext including
their leaf index, the current generation counter and a hash of the GroupContext.
 (A hash is used to avoid having to evaluate the KDF on the, possibly quite
large, GroupContext struct each time a new challenge is sampled.) The
application may supply further context in the applicaiton_context field.
Finally, the challenge is derived from the challenge-seed and ChallengeContext
using the KDF and tehe generation counter is incremented.<a href="#section-3.7.1.1-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.7.1.1-5">
<pre>
group_context_hash = Hash(GroupContext)

struct {
        opaque group_context_hash;
        uint32 sender_leaf_index;
        opaque application_context;
} ChallengeContext

challenge = KDF.Expand(challenge-seed, ChallengeContext, KDF.Nh)
</pre><a href="#section-3.7.1.1-5" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="message-framing">
<section id="section-3.7.1.2">
            <h5 id="name-message-framing">
<a href="#section-3.7.1.2" class="section-number selfRef">3.7.1.2. </a><a href="#name-message-framing" class="section-name selfRef">Message Framing</a>
            </h5>
<p id="section-3.7.1.2-1">The following enum and structs define the wire format for challenge-based
application messages.<a href="#section-3.7.1.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.7.1.2-2">
<pre>
enum {
        reserved(0),
    random-access(1),
        private-anonymous(2),
        public-anonymous(3),
        (256)
} CBAMSenderMode

struct {
    CBAMSenderMode mode;
        uint8 challenge[KDF.Nh];
    select (CBAMSender.mode) {
        case random-access:
            uint32 leaf_index;
        case priavte-anonymous:
        case public-anonymous:
            struct{};
    };
} CBAMSender;

struct {
    ProtocolVersion version = mls10;
    WireFormat wire_format;
    CBAMPrivateMessage private_message;
} CBAMMLSMessage;
</pre><a href="#section-3.7.1.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="message-authentication">
<section id="section-3.7.1.3">
            <h5 id="name-message-authentication">
<a href="#section-3.7.1.3" class="section-number selfRef">3.7.1.3. </a><a href="#name-message-authentication" class="section-name selfRef">Message Authentication</a>
            </h5>
<p id="section-3.7.1.3-1">The following structs are used to authenticate data in a challenge-based
application message. When using random-access mode, this is done almost
identically to standard application messages. In public-anonymous mode the
signature is producing using the groups signature keys described in
<a href="#group-signature-keys" class="auto internal xref">Section 3.7.1.7</a>. The private-anonymous mode omits signatures entirely.<a href="#section-3.7.1.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.7.1.3-2">
<pre>
// See the "MLS Wire Formats" IANA registry for values
uint16 WireFormat;

struct {
    opaque group_id&lt;V&gt;;
    uint64 epoch;
    CBAMSender sender;
    opaque authenticated_data&lt;V&gt;;
        opaque application_data&lt;V&gt;;
} CBAMFramedContent

struct {
    ProtocolVersion version = mls10;
    WireFormat wire_format;
    CBAMFramedContent content;
        GroupContext context;
} CBAMFramedContentTBS;

struct {
        select(FramedContentTBS.content.sender.mode) {
                case random-access:
                case public-anonymous:
                        /* SignWithLabel(., "CBAMFramedContentTBS", CBAMFramedContentTBS) */
                        opaque signature&lt;V&gt;;
                case private-anonymous:
                        struct{};
        }
} CBAMFramedContentAuthData;

struct {
    WireFormat wire_format;
    CBAMFramedContent content;
    CBAMFramedContentAuthData auth;
} CBAMAuthenticatedContent;
</pre><a href="#section-3.7.1.3-2" class="pilcrow">¶</a>
</div>
<p id="section-3.7.1.3-3">Challenge-based application messages are encoded, authenticated and encrypted
much like MLS private messages using the CBAMPrivateMessage struct.<a href="#section-3.7.1.3-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.7.1.3-4">
<pre>
struct {
    opaque group_id&lt;V&gt;;
    uint64 epoch;
    opaque authenticated_data&lt;V&gt;;
    opaque encrypted_cbam_sender_data&lt;V&gt;;
    opaque cbam_encrypted_cbam_private_message_content&lt;V&gt;;
} CBAMPrivateMessage;
</pre><a href="#section-3.7.1.3-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="content-encryption">
<section id="section-3.7.1.4">
            <h5 id="name-content-encryption">
<a href="#section-3.7.1.4" class="section-number selfRef">3.7.1.4. </a><a href="#name-content-encryption" class="section-name selfRef">Content Encryption</a>
            </h5>
<p id="section-3.7.1.4-1">Content to be encrypted is encoded with a CBAMPrivateMessageContent and the
Additional Authenticated data is encoded with a CBAMPrivateContentAAD. The key
and nonce used for encryption are derived from the encryption_secret and the
challenge C using the challenge-based secret tree as described in
<a href="#forward-secure-kdf" class="auto internal xref">Section 3.7.1.6</a>.<a href="#section-3.7.1.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.7.1.4-2">
<pre>
struct {
        opaque application_data&lt;V&gt;;
    CBAMFramedContentAuthData auth;
    opaque padding[length_of_padding];
} CBAMPrivateMessageContent;

struct {
    opaque group_id&lt;V&gt;;
    uint64 epoch;
    opaque cbam_authenticated_data&lt;V&gt;;
} CBMAPrivateContentAAD;

aead_key = aead_key[C]

aead_nonce = aead_nonce[C]
</pre><a href="#section-3.7.1.4-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sender-data-encryption">
<section id="section-3.7.1.5">
            <h5 id="name-sender-data-encryption">
<a href="#section-3.7.1.5" class="section-number selfRef">3.7.1.5. </a><a href="#name-sender-data-encryption" class="section-name selfRef">Sender Data Encryption</a>
            </h5>
<p id="section-3.7.1.5-1">The encrypted_cbam_sender_data is obtained by encrypting the CBAMSenderData
using keys derived from the cbam_sender_data_secret. This secret is exported
using the safe API's forward-secure exporter function MLS-FS-Exporter using the
label "CBAM Sender Data Secret" and an empty context. Other than that, the same
method is used to encrypt sender data as for standard application messages.<a href="#section-3.7.1.5-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.7.1.5-2">
<pre>
cbam_sender_data_secret = MLS-FS-Export("CBAM Sender Data Secret", "", KDF.Nk)

ciphertext_sample = ciphertext[0..KDF.Nh-1]

sender_data_key = ExpandWithLabel(cbam_sender_data_secret, "key",
                      ciphertext_sample, AEAD.Nk)
sender_data_nonce = ExpandWithLabel(cbam_sender_data_secret, "nonce",
                      ciphertext_sample, AEAD.Nn)
</pre><a href="#section-3.7.1.5-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="forward-secure-kdf">
<section id="section-3.7.1.6">
            <h5 id="name-forward-secure-kdf">
<a href="#section-3.7.1.6" class="section-number selfRef">3.7.1.6. </a><a href="#name-forward-secure-kdf" class="section-name selfRef">Forward Secure KDF</a>
            </h5>
<p id="section-3.7.1.6-1">A consequence of the secret tree structure in MLS is that deriving the key/nonce
 for a given application message requires knowing the leaf node of the client.
The symmetric ratchets in MLS require performing as many (KDF and storage)
operations as application messages are being skipped. The challenge-based secret
 tree (CBST) described in this section avoids these issues. Like the secret tree
 in MLS, it consists of a binary tree of secrets. However, leaves are indexed by
 challenges instead of leaf nodes which means the tree now has depth KDF.Nh.<a href="#section-3.7.1.6-1" class="pilcrow">¶</a></p>
<p id="section-3.7.1.6-2">Nodes in the CBST are identified by the string encoding the path from the root
to the node. The root is identified by the empty string "". If a node is
identified by string <code>N</code> then its left child is identified the string <code>N||0</code> and
 the right child by the string <code>N||1</code>. Each node is assigned a secret. The root
is assigned the cbam_encryption_secret which is exported from the MLS session
using the safe API's FS-Export function. All other nodes in the CBST are
assigned a secrety by applying ExpandWithLabel to its parents secret with
appropriate labels.<a href="#section-3.7.1.6-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.7.1.6-3">
<pre>
cbst_encryption_secret = MLS-FS-Export("CBST", "", KDF.Nh)

cbst_tree_node_[""]_secret = cbst_encryption_secret

cbst_tree_node_[N]_secret
        |
        |
        +--&gt; ExpandWithLabel(., "CBST", "left", KDF.Nh)
        |    = cbst_tree_node_[left(N)]_secret
        |
        +--&gt; ExpandWithLabel(., "CBST", "right", KDF.Nh)
             = cbst_tree_node_[right(N)]_secret
</pre><a href="#section-3.7.1.6-3" class="pilcrow">¶</a>
</div>
<p id="section-3.7.1.6-4">The key and nonce for a KDF.Nh octet long challenge C are derived from the
secret for leaf node identified by C.<a href="#section-3.7.1.6-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.7.1.6-5">
<pre>
aead_key[C] = ExpandWithLabel(cbst_tree_node[C]_secret, "CBST", "key", KDF.Nh)

nonce_key[C] = ExpandWithLabel(cbst_tree_node[C]_secret, "CBST", "nonce",
KDF.Nh)
</pre><a href="#section-3.7.1.6-5" class="pilcrow">¶</a>
</div>
<p id="section-3.7.1.6-6">The same deletion schedule applies to the CBST (including the
cbst_encryption_secret) as for the secret tree in MLS.<a href="#section-3.7.1.6-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="group-signature-keys">
<section id="section-3.7.1.7">
            <h5 id="name-group-signature-keys">
<a href="#section-3.7.1.7" class="section-number selfRef">3.7.1.7. </a><a href="#name-group-signature-keys" class="section-name selfRef">Group Signature Keys</a>
            </h5>
<p id="section-3.7.1.7-1">All clients in an epoch can derive the epoch's group signing key pair using the
DeriveSigKeyPair() function associated with the signture scheme of the cipher
suite. It maps input key material octet strings to signature key pairs. The
input key material is obtained using the safe API's forward-secure exporter
function. A signature of a message using  the group's signing key represents a
publicly verifiable attestation to the message author's group membership while
hiding which particular client in the group authored the message.<a href="#section-3.7.1.7-1" class="pilcrow">¶</a></p>
<p id="section-3.7.1.7-2">For ECDSA signature schemes using curves P-256, P-384 and P-512 the
DeriveSigKeyPair() algorithm is identical to the DeriveKeyPair() algorithm for
those curves in HPKE <span>[<a href="#RFC9180" class="cite xref">RFC9180</a>]</span>. For the Ed25519 and Ed448 signature schemes
the DeriveSigKeyPair() is identical to the DeriveKeyPair() algorithm for X25519
and X448 in HPKE <span>[<a href="#RFC9180" class="cite xref">RFC9180</a>]</span> except that the pk(sk) function for deriving
Ed25519 and Ed448 public keys from a secret keys given in <span>[<a href="#RFC8032" class="cite xref">RFC8032</a>]</span> are used
instead of the functions for X25519 and X448.<a href="#section-3.7.1.7-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.7.1.7-3">
<pre>
gsig_ikm = MLS-FS-Exporter("Group Signature Keys IKM", "", KDF.Nh)

(gs-sk, gs-pk) = DeriveSigKeyPair(gsig_ikm)
</pre><a href="#section-3.7.1.7-3" class="pilcrow">¶</a>
</div>
<p id="section-3.7.1.7-4">As part of a commit, applications MAY want to communicate the new group signing
public key to the DS. For this clients MAY include in an inline safe API
extension_proposal proposal in Commit sent as PublicMessage. For this, clients
set the extension_data field of the ExtensionContent to be the new epoch's group
 public key pg-pk. Upon receiving a commit with such an extension clients MUST
verify that the indicated gs-pk is correct. If the check fails clients MUST
reject commit.<a href="#section-3.7.1.7-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-considerations-for-anonymous-modes">
<section id="section-3.7.1.8">
            <h5 id="name-security-considerations-for">
<a href="#section-3.7.1.8" class="section-number selfRef">3.7.1.8. </a><a href="#name-security-considerations-for" class="section-name selfRef">Security Considerations For Anonymous Modes</a>
            </h5>
<ul class="normal">
<li class="normal" id="section-3.7.1.8-1.1">
                <p id="section-3.7.1.8-1.1.1">Weaker PCS Authenticity.<a href="#section-3.7.1.8-1.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</section>
</div>
<div id="thoughts-for-safe-api">
<section id="section-3.7.1.9">
            <h5 id="name-thoughts-for-safe-api">
<a href="#section-3.7.1.9" class="section-number selfRef">3.7.1.9. </a><a href="#name-thoughts-for-safe-api" class="section-name selfRef">Thoughts for Safe API</a>
            </h5>
<ul class="normal">
<li class="normal" id="section-3.7.1.9-1.1">
                <p id="section-3.7.1.9-1.1.1">Expose Group Context struct.<a href="#section-3.7.1.9-1.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-3.7.1.9-1.2">
                <p id="section-3.7.1.9-1.2.1">Let extensions safely add authenticated_data to MLSMessages. This lets them
communicate data to the DS even though PrivateMessages are being used. E.g. for
commits we might want to let the DS know what the new group signing key is but
still use PrivateMessage for a commit to hide everything else.<a href="#section-3.7.1.9-1.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</section>
</div>
<div id="legacy-text">
<section id="section-3.7.1.10">
            <h5 id="name-legacy-text">
<a href="#section-3.7.1.10" class="section-number selfRef">3.7.1.10. </a><a href="#name-legacy-text" class="section-name selfRef">Legacy Text</a>
            </h5>
<p id="section-3.7.1.10-1">Key/nonce pairs used to encrypt application messages are derived using a PPRF.
That is, the Secret Tree in the super group is replaced by a GGM-style PPRF
initially keyed by the <code>encryption_secret</code>. To send an application messaage,
the sending emulator client choose a 32 byte challenge and includes it in the
<code>authenticated_data</code> field in the <code>PrivateMessage</code> struct. To derive the nonce
and AEAD key for the application message the PPRF is evaluated (and punctured)
the PPRF at the challenge. Due to the entropy in the challenge nonce-reuse
guards can be dropped.<a href="#section-3.7.1.10-1" class="pilcrow">¶</a></p>
<p id="section-3.7.1.10-2">Advantages:
- Group Structure Agnostic : The construction is agnostic to all aspects of the
group's membership structure. For example, clients can receive application
messages without knowing the sender's leaf index in it's virtual client nor
the relative position of the sender's virtual client in the hiearchy of virtual
clients making up the super group.
- Metadata Hiding: The scheme hides everything about a sender's position in the
groups membership heirachy beyond what is revealed by the signature. For
example, application messages are as unlinkabel as permited by their signatures
(even for other emulation clients in the same virtual client).
- Forward Security Sender Anonymity : Leaking a clients PPRF local state reveals
nothing about who sent previously received application messages. This includes
both hiding both the sending emulation clients and even their virtual clients.<a href="#section-3.7.1.10-2" class="pilcrow">¶</a></p>
<p id="section-3.7.1.10-3">Disadvantages:
- Breaks the RFC9420 specification &amp; requires an un-safe extension.
- Applications messages have an added 28 byte overhead.
- Senders need 28 additional random bytes to send an application message.
- A decryption error occurs when receiving an application message with a
previously used challenge (in the current epoch).<a href="#section-3.7.1.10-3" class="pilcrow">¶</a></p>
<p id="section-3.7.1.10-4">There is a trade-off between cost and error probability when choosing <code>b</code>; the
bit-length of challenges. (Above <code>b = 256</code> which is very conservative.)
- Sending two application messages with the same challenge in an epoch
immediatly leaks the XOR of the two plaintexts and results in decryption
failures for which ever message a client receives second. The probability a
challenge gets re-used when <code>k</code> application messages with <code>b</code>-bit challenges
are sent in an epoch (without any coordination) is
<code>err = 1-[C(2^b,k)/C(2^b+k-1)]</code>. So larger <code>b</code> reduces the probability of
challenge re-use exponentially.
- Evaluating the PPRF requires up to <code>b</code> HKDF calls and new 32B values to be
stored locally by the client. Moreover, <code>b</code>-bit challenges impost a <code>8b-4</code> bytes
of overhead in application messages and added random bits when sending.<a href="#section-3.7.1.10-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="rotation-of-authentication-key-material">
<section id="section-3.8">
        <h3 id="name-rotation-of-authentication-">
<a href="#section-3.8" class="section-number selfRef">3.8. </a><a href="#name-rotation-of-authentication-" class="section-name selfRef">Rotation of authentication key material</a>
        </h3>
<p id="section-3.8-1">If the design of the AS specifies the use of cross-group authentication key
material, emulator clients must coordinate the rotation of said key material in
the emulation group to avoid multiple emulator clients rotating a key at the
same time. Details depend on the design of the AS.<a href="#section-3.8-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-4">
      <h2 id="name-security-considerations">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-security-considerations" class="section-name selfRef">Security considerations</a>
      </h2>
<p id="section-4-1">TODO: Detail security considerations once the protocol has evolved a little
more. Starting points:<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">Some of the performance benefits of this scheme depend on the fact that one can
update once in the emulation group and “re-use” the new randomness for updates
in multiple higher-level groups. At that point, clients only really recover when
they update the emulation group, i.e. re-using somewhat old randomness of the
emulation group won’t provide real PCS in higher-level groups.<a href="#section-4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="privacy-considerations">
<section id="section-5">
      <h2 id="name-privacy-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-privacy-considerations" class="section-name selfRef">Privacy considerations</a>
      </h2>
<p id="section-5-1">TODO: Specify the metadata hiding properties of the protocol. The details depend
on how we solve some of the problems described throughout this document.
However, using a virtual client should mask add/remove activity in the
underlying emulation group. If it actually hides the identity of the members may
depend on the details of the AS, as well as how we solve the application
messages problem.<a href="#section-5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="performance-considerations">
<section id="section-6">
      <h2 id="name-performance-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-performance-considerations" class="section-name selfRef">Performance considerations</a>
      </h2>
<p id="section-6-1">There are several use cases, where a specific group of clients represents a
higher-level entity such as a user, or a part of an organization. If that group
of clients shares membership in a large number of groups, where its sole purpose
is to represent the higher-level entity, then instead emulating a virtual client
can yield a number of performance benefits, especially if this strategy is
employed across an implementation. Generally, the more emulator clients are
hidden behind a single virtual client and the more clients are replaced by
virtual clients, the higher the potential performance benefits.<a href="#section-6-1" class="pilcrow">¶</a></p>
<div id="smaller-trees">
<section id="section-6.1">
        <h3 id="name-smaller-trees">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-smaller-trees" class="section-name selfRef">Smaller Trees</a>
        </h3>
<p id="section-6.1-1">As a general rule, groups where one or more sets of clients are replaced by
virtual clients have fewer members, which leads to cheaper MLS operations where
the cost depends on the group size, e.g., commits with a path, the download size
of the group state for new members, etc. This increase in performance can offset
performance penalties, for example, when using a PQ-secure cipher suite, or if
the application requires high update frequencies (deniability).<a href="#section-6.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="fewer-blanks">
<section id="section-6.2">
        <h3 id="name-fewer-blanks">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-fewer-blanks" class="section-name selfRef">Fewer blanks</a>
        </h3>
<p id="section-6.2-1">Blanks are typically created in the process of client removals. With virtual
clients, the removal of an emulator client will not cause the leaf of the
virtual client (or indeed any node in the virtual client’s direct path) to be
blanked, except if it is the last remaining emulator client. As a result,
fluctuation in emulator clients does not necessarily lead to blanks in the group
of the corresponding virtual clients, resulting in fewer overall blanks and
better performance for all group members.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="emulation-costs">
<section id="section-7">
      <h2 id="name-emulation-costs">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-emulation-costs" class="section-name selfRef">Emulation costs</a>
      </h2>
<p id="section-7-1">From a performance standpoint, using virtual clients only makes sense if the
performance benefits from smaller trees and fewer blanks outweigh the
performance overhead incurred by emulating the virtual client in the first
place.<a href="#section-7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-normative-references">
<section id="section-8">
      <h2 id="name-normative-references">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="I-D.draft-ietf-mls-extensions">[I-D.draft-ietf-mls-extensions]</dt>
      <dd>
<span class="refAuthor">Robert, R.</span>, <span class="refTitle">"The Messaging Layer Security (MLS) Extensions"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-mls-extensions-03</span>, <time datetime="2023-10-23" class="refDate">23 October 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-mls-extensions-03">https://datatracker.ietf.org/doc/html/draft-ietf-mls-extensions-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8032">[RFC8032]</dt>
      <dd>
<span class="refAuthor">Josefsson, S.</span> and <span class="refAuthor">I. Liusvaara</span>, <span class="refTitle">"Edwards-Curve Digital Signature Algorithm (EdDSA)"</span>, <span class="seriesInfo">RFC 8032</span>, <span class="seriesInfo">DOI 10.17487/RFC8032</span>, <time datetime="2017-01" class="refDate">January 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8032">https://www.rfc-editor.org/rfc/rfc8032</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9180">[RFC9180]</dt>
      <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Bhargavan, K.</span>, <span class="refAuthor">Lipp, B.</span>, and <span class="refAuthor">C. Wood</span>, <span class="refTitle">"Hybrid Public Key Encryption"</span>, <span class="seriesInfo">RFC 9180</span>, <span class="seriesInfo">DOI 10.17487/RFC9180</span>, <time datetime="2022-02" class="refDate">February 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9180">https://www.rfc-editor.org/rfc/rfc9180</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9420">[RFC9420]</dt>
    <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Beurdouche, B.</span>, <span class="refAuthor">Robert, R.</span>, <span class="refAuthor">Millican, J.</span>, <span class="refAuthor">Omara, E.</span>, and <span class="refAuthor">K. Cohn-Gordon</span>, <span class="refTitle">"The Messaging Layer Security (MLS) Protocol"</span>, <span class="seriesInfo">RFC 9420</span>, <span class="seriesInfo">DOI 10.17487/RFC9420</span>, <time datetime="2023-07" class="refDate">July 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9420">https://www.rfc-editor.org/rfc/rfc9420</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Konrad Kohbrok</span></div>
<div dir="auto" class="left"><span class="org">Phoenix R&amp;D</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:konrad.kohbrok@datashrine.de" class="email">konrad.kohbrok@datashrine.de</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Raphael Robert</span></div>
<div dir="auto" class="left"><span class="org">Phoenix R&amp;D</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ietf@raphaelrobert.com" class="email">ietf@raphaelrobert.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
