<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>MLS Virtual Clients</title>
<meta content="Konrad Kohbrok" name="author">
<meta content="Raphael Robert" name="author">
<meta content="
       This document describes a method that allows multiple MLS clients to emulate a
virtual MLS client. A virtual client allows multiple emulator clients to jointly
participate in an MLS group under a single leaf. Depending on the design of the
application, virtual clients can help hide metadata and improve performance. 
    " name="description">
<meta content="xml2rfc 3.18.2" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-kohbrok-mls-virtual-clients-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.18.2
    Python 3.10.12
    ConfigArgParse 1.7
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.3
    platformdirs 4.0.0
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.31.0
    setuptools 68.2.2
    six 1.16.0
    wcwidth 0.2.9
-->
<link href="draft-kohbrok-mls-virtual-clients.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">MVC</td>
<td class="right">November 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Kohbrok &amp; Robert</td>
<td class="center">Expires 24 May 2024</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-kohbrok-mls-virtual-clients-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2023-11-21" class="published">21 November 2023</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2024-05-24">24 May 2024</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">K. Kohbrok</div>
<div class="org">Phoenix R&amp;D</div>
</div>
<div class="author">
      <div class="author-name">R. Robert</div>
<div class="org">Phoenix R&amp;D</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">MLS Virtual Clients</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes a method that allows multiple MLS clients to emulate a
virtual MLS client. A virtual client allows multiple emulator clients to jointly
participate in an MLS group under a single leaf. Depending on the design of the
application, virtual clients can help hide metadata and improve performance.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 24 May 2024.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-tenets" class="internal xref">Tenets</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1" class="keepWithNext"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-client-emulation" class="internal xref">Client emulation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-generating-virtual-client-s" class="internal xref">Generating Virtual Client Secrets</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-key-package" class="internal xref">Key Package</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-commits-in-supergroups" class="internal xref">Commits in Supergroups.</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-update-proposals-in-supergr" class="internal xref">Update Proposals in Supergroups.</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.1">
                    <p id="section-toc.1-1.4.2.4.2.1.1"><a href="#section-4.4.1" class="auto internal xref">4.4.1</a>.  <a href="#name-sub-goup-membership-change" class="internal xref">Sub-goup Membership Change</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-challenge-based-application" class="internal xref">Challenge-Based Application Messages.</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="auto internal xref">4.6</a>.  <a href="#name-adding-and-removing-emulato" class="internal xref">Adding and Removing Emulator Clients</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7">
                <p id="section-toc.1-1.4.2.7.1"><a href="#section-4.7" class="auto internal xref">4.7</a>.  <a href="#name-example-protocol-flow" class="internal xref">Example protocol flow</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8">
                <p id="section-toc.1-1.4.2.8.1"><a href="#section-4.8" class="auto internal xref">4.8</a>.  <a href="#name-ds-as-details" class="internal xref">DS/AS Details</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.9">
                <p id="section-toc.1-1.4.2.9.1"><a href="#section-4.9" class="auto internal xref">4.9</a>.  <a href="#name-agreement-on-generation-of-" class="internal xref">Agreement on/generation of key material</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.10">
                <p id="section-toc.1-1.4.2.10.1"><a href="#section-4.10" class="auto internal xref">4.10</a>. <a href="#name-coordinating-virtual-client" class="internal xref">Coordinating virtual client operations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.11">
                <p id="section-toc.1-1.4.2.11.1"><a href="#section-4.11" class="auto internal xref">4.11</a>. <a href="#name-possible-message-re-orderin" class="internal xref">Possible message re-ordering</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.12">
                <p id="section-toc.1-1.4.2.12.1"><a href="#section-4.12" class="auto internal xref">4.12</a>. <a href="#name-adding-emulator-clients" class="internal xref">Adding emulator clients</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.13">
                <p id="section-toc.1-1.4.2.13.1"><a href="#section-4.13" class="auto internal xref">4.13</a>. <a href="#name-sending-application-message" class="internal xref">Sending application messages</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.13.2.1">
                    <p id="section-toc.1-1.4.2.13.2.1.1"><a href="#section-4.13.1" class="auto internal xref">4.13.1</a>.  <a href="#name-pprf-based-challenges" class="internal xref">PPRF-based Challenges</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.14">
                <p id="section-toc.1-1.4.2.14.1"><a href="#section-4.14" class="auto internal xref">4.14</a>. <a href="#name-rotation-of-authentication-" class="internal xref">Rotation of authentication key material</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-security-considerations" class="internal xref">Security considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-privacy-considerations" class="internal xref">Privacy considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-performance-considerations" class="internal xref">Performance considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-smaller-trees" class="internal xref">Smaller Trees</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-fewer-blanks" class="internal xref">Fewer blanks</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-emulation-costs" class="internal xref">Emulation costs</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The MLS protocol facilitates communication between clients, where in an MLS
group, each client is represented by the leaf to which it holds the private key
material. In this document, we propose the notion of a virtual client that is
jointly emulated by a group of emulator clients, where each emulator client
holds the key material necessary to act as the virtual client.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">Depending on the use case, the use of virtual clients can lead to performance
increases and hide metadata from the DS and other group members. On the other
hand, it introduces complexity and additional operational requirements.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">We discuss technical challenges and propose a concrete scheme that allows a
group of clients to emulate a virtual client that can participate in one or more
MLS groups.<a href="#section-1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="tenets">
<section id="section-2">
      <h2 id="name-tenets">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-tenets" class="section-name selfRef">Tenets</a>
      </h2>
<p id="section-2-1">Guiding principles and goals to work towards.<a href="#section-2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-2.1">
          <p id="section-2-2.1.1">Minimize number of required commits. Especially, interdependent ones across groups.<a href="#section-2-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-2.2">
          <p id="section-2-2.2.1">Simplicity &amp; clarity &gt; efficiency<a href="#section-2-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-2.3">
          <p id="section-2-2.3.1">Real vs. virtual client members look the same to the rest of the group.<a href="#section-2-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-2.4">
          <p id="section-2-2.4.1">Compatible with standard MLS DS.<a href="#section-2-2.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-2.5">
          <p id="section-2-2.5.1">Virtual clients should look like real clients to the DS.<a href="#section-2-2.5.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="terminology">
<section id="section-3">
      <h2 id="name-terminology">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<ul class="normal">
<li class="normal" id="section-3-1.1">
          <p id="section-3-1.1.1">Client: Any MLS client including emulator clients, virtual clients and real
clients.<a href="#section-3-1.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-1.2">
          <p id="section-3-1.2.1">Real Client: An MLS client whose secret key material is help by a single
agent.<a href="#section-3-1.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-1.3">
          <p id="section-3-1.3.1">Virtual Client: A client for which the secret key material is held by one or
more other clients, each of which can act as the virtual client.<a href="#section-3-1.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-1.4">
          <p id="section-3-1.4.1">Emulator Client: A client that collaborates with other emulator clients in
emulating a virtual client. Emulator clients can be real or virtual clients.<a href="#section-3-1.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-1.5">
          <p id="section-3-1.5.1">Heirarchical group: A generalization of an MLS group in which members can be
either virtual or real clients. Heirarchical group members may also act as
emulator clients to collaboratively emulate a virtual client representing the
heirarchical group in one or more other heirarchical groups.<a href="#section-3-1.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-1.6">
          <p id="section-3-1.6.1">Group representative: A group representative of (heirarchical group) G is a
virtual client emulated by the clients in G. The group representative of group
G in another group S is the representative of G that is a member S.<a href="#section-3-1.6.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-1.7">
          <p id="section-3-1.7.1">Subgroup: a heirarchical group with a representative in one or more other
groups.<a href="#section-3-1.7.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-1.8">
          <p id="section-3-1.8.1">Supergroup: a heirarchical group with one or more virtual members.<a href="#section-3-1.8.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-3-2">TODO: Terminology is up for debate. We’ve sometimes called this “user trees”,
but since there are other use cases, we should choose a more neutral name. For
now, it’s virtual client emulation.<a href="#section-3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-emulation">
<section id="section-4">
      <h2 id="name-client-emulation">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-client-emulation" class="section-name selfRef">Client emulation</a>
      </h2>
<p id="section-4-1">A set of emulator clients that want to emulate one or more virtual clients form an MLS heirarchical group G. To act as a virtual client R representing G the emulating clients in G must each learn all secret held by R. This includes secrets associated with R's key packages and leaf nodes in groups R is a member of. This is done by deriving any such secrets deterministically using seeds exported from G's key schedule. To help coordinate this, the emulator client that first creates a representative R of group G assigns R a virtual client ID unique among all representatives of G. Similarly, as part of their creation, each key package of R is assigned an ID unique among all key packages generated for R using the same epoch's key schedule.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">Just like real clients, a virtual client R can join or create any group S and even be an emulator client for some other virtual client. If R joins a group S then this makes G a subgroup of supergroup S and with R being G's representative in S. G may have 0 or more representatives which can each be a member of 0 or more supergroups. G and all of its supergroups MUST have unique group IDs. G can have at most 1 representative in a supergroup S.<a href="#section-4-2" class="pilcrow">¶</a></p>
<div id="generating-virtual-client-secrets">
<section id="section-4.1">
        <h3 id="name-generating-virtual-client-s">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-generating-virtual-client-s" class="section-name selfRef">Generating Virtual Client Secrets</a>
        </h3>
<p id="section-4.1-1">For each epoch in G members use the Safe API's FS-Export method to obtain the virtual_client_seed for the epoch.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-2">
<pre>
virtual_client_seed = MLS-FS-Export("Virtual Client Seed", "", HKDF.Nh)
</pre><a href="#section-4.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.1-3">Later, they derive further seeds from virtual using the following context struct.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-4">
<pre>
struct {
  uint16 virtual_client_ID;
  uint32 emulator_client_leaf_index;
  opaque emulator_group_context_hash;
  opaque extended_context
} VClientSeedContext

seed = ExpandWithLabel(virtual_client_seed, "Virtual Client Secrets", VClientSeedContext)
</pre><a href="#section-4.1-4" class="pilcrow">¶</a>
</div>
<p id="section-4.1-5">OPEN QUESTION<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-6.1">
            <p id="section-4.1-6.1.1">Reasons why we should use FS-Exporter(), not Exporter(): Want to ensure immediate FS when sks derived from seeds deleted with out requireing subgroup commit just to erase exporter_secret. Scenario 1: Gen KP. KP used for Welcome msg. Process Welcome to join supergroup S. Delete init_key sk. Now we want FS for init_key to kick in immediatly (i.e. without having to first move G to a new epoch to clear out its exporter_secret.) Scenario 2: Commit in supergroup to get leaf node LN1. Gen update for supergroup. Update commited in supergroup to get leafe node LN2. Delete LF1 sks. We want FS for LF1 without needing a commit in subgroup to force delete exporter_secret.<a href="#section-4.1-6.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-6.2">
            <p id="section-4.1-6.2.1">Do we care if two emulator clients produce the same commits or proposals concurrently but with different signatures and nonce-reuse guard? Similar question for one emulator client producing two similar KPs or updates. I dont think its a security issue? Just a bit messy. Could reveal that a client is virtual not real though? If we do care then could add emulator client's leaf_index and a seed_counter to ReKeySeedContext. Mitigates problem because now seed collisions only possible under quite limited circumstances.<a href="#section-4.1-6.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-6.3">
            <p id="section-4.1-6.3.1">How to coordinate KeyPackage IDs? We could use an extension in the KP to signal its KPID to other emulator clients. But if we avoid that, then a virtual clients KP could look identical to that of a real client which would be cool. Maybe signal KPIDs for upcoming KP's in a commit to G? Seems robust (guarantees coordination and avoids collisions on KPIDs) but also a bit limiting. If decide I want to generate a new KP for a representative I now first have to commit in G but not for security, just to tell people the new KPID. But application msgs aren't even guaranteed to arrive so is that ok? Also should we use explicite KPIDs? or is it ok to use the init_key in the KP as the KPID?<a href="#section-4.1-6.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="key-package">
<section id="section-4.2">
        <h3 id="name-key-package">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-key-package" class="section-name selfRef">Key Package</a>
        </h3>
<p id="section-4.2-1">If this is a new representative then first choose VCID. Choose fresh KPID(s). Commit in G anouncing (VCID and) KPIDs privatly to the group. Generate KPs from new epochs key schedule using VCID and KPID in the context.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2-2">
<pre>
struct {
  uint16 key_package_ID;
  opaque pre-seed[HKDF.Nh];
} KPSeedContext
</pre><a href="#section-4.2-2" class="pilcrow">¶</a>
</div>
<p id="section-4.2-3">OPEN QUESTIONS<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.2-4">The following issue arrises for commits, proposals key packages of virtual clients. There's a trade-off between ensuring tight PCS vs. minimizing number of (subgroup) commits. Here are 2 strawmen designs for managing virtual client key packages showing the trade-off:<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.2-5">
<li id="section-4.2-5.1">
            <p id="section-4.2-5.1.1">Sample fresh kp_seed. Generate KP secrets with kp_seed. Send (KP, kp_seed) to subgroup in application message. Pro: no subgroup commit needed to generate KP. Con: PCS window for KP starts at begining of subgroup epoch instead of when KP was actually generated.<a href="#section-4.2-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.2-5.2">
            <p id="section-4.2-5.2.1">Commit in subgroup anouncing new KP's KPSeedContext. Get kp_seed := FS-Export(KPSeedContext). Use it to generate KP secrets. Send KP to subgroup as app msg. Con: subgroup commit needed to generate KP. Pro: PCS window for KP is tight; starts when KP generated.<a href="#section-4.2-5.2.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-4.2-6">TODO<a href="#section-4.2-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-7.1">
            <p id="section-4.2-7.1.1">If the KPSeedContext struct ends up with just one uint16 in it we can remove it again and use the uint16 directly instead.<a href="#section-4.2-7.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="commits-in-supergroups">
<section id="section-4.3">
        <h3 id="name-commits-in-supergroups">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-commits-in-supergroups" class="section-name selfRef">Commits in Supergroups.</a>
        </h3>
<p id="section-4.3-1">To commit as a representative in supergroup S, first commit in subgroup G. Next use new epoch's FS-Exporter to derive new leaf node and path secret for representative's commit in S. In VClientSeedContext include S's GroupContext to avoid collisions between supergroups.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3-2">
<pre>
struct {
  uint8 rekey_seed[AEAD.Nk];
  opaque supergroup_context_hash;
} ReKeySeedContext
</pre><a href="#section-4.3-2" class="pilcrow">¶</a>
</div>
<p id="section-4.3-3">OPEN QUESTIONS<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-4.1">
            <p id="section-4.3-4.1.1">How can clients send private and authenticated extension-specific data along with a commit? Maybe Safe API can give wrap authenticated_data in FramedContent to give extensions a safe way to do this? E.g. we want to communicate "This subgroup commit creates an epoch from which I'm deriving the seeds for a virtual client R in supergroup G with commit<a href="#section-4.3-4.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="update-proposals-in-supergroups">
<section id="section-4.4">
        <h3 id="name-update-proposals-in-supergr">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-update-proposals-in-supergr" class="section-name selfRef">Update Proposals in Supergroups.</a>
        </h3>
<p id="section-4.4-1">OPEN QUESTIONS<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-2.1">
            <p id="section-4.4-2.1.1">Raises similar questions as for KPs. How to minimize commits while getting PFCS for leaf_node in Updates.<a href="#section-4.4-2.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<div id="sub-goup-membership-change">
<section id="section-4.4.1">
          <h4 id="name-sub-goup-membership-change">
<a href="#section-4.4.1" class="section-number selfRef">4.4.1. </a><a href="#name-sub-goup-membership-change" class="section-name selfRef">Sub-goup Membership Change</a>
          </h4>
<p id="section-4.4.1-1">Commits in subgroup are just like for MLS with the following additions.<a href="#section-4.4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.1-2.1">
              <p id="section-4.4.1-2.1.1">Privately send all representatives' states to new members in welcome message.<a href="#section-4.4.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.1-2.2">
              <p id="section-4.4.1-2.2.1">When removing subgroup members MUST expire all representatives' secrets. KP's deleted (and replaced). Commits (or updates) in all supergroups. (pfui!) Security Consideration: Remove from subgroup not complete until all old KP's revoked, supergroup commits done, and update proposals commited too in supergroup.<a href="#section-4.4.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.4.1-3">OPEN QUESTIONS<a href="#section-4.4.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.1-4.1">
              <p id="section-4.4.1-4.1.1">What to do about external joins? "clients obtain representatives' states out-of-band"? external joiners can revoke &amp; replace reprsentatives' KPs?<a href="#section-4.4.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="challenge-based-application-messages">
<section id="section-4.5">
        <h3 id="name-challenge-based-application">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-challenge-based-application" class="section-name selfRef">Challenge-Based Application Messages.</a>
        </h3>
<p id="section-4.5-1">Needed so that emulator clients dont collide on key/nonce pairs when concurrently sending in a supergroup. See random-access mode in git branch app-msgs for details.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<p id="section-4.5-2">Application messages are used to send two types of information about to a. Either higher-level application data or information about an action taken by an emulator client on behalf of a group's representative. The following struct encodes application messages signaling their purpose to receivers.<a href="#section-4.5-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5-3">
<pre>
enum {
  reserved(0),
  virtual_client_info(1),
  application_message(2),
  (255)
} ApplicationMessageType

enum {
  reserved(0),
  key_package(1),
  propsal(2),
} VirtualClientAction

struct {
  ApplicationMessageType app_msg_type;
  select (ApplicationMessage.app_msg_type) {
    case application_message:
      opaque application_data&lt;V&gt;;

    case virtual_client_info:
      VirtualClientAction virtual_client_action;
      select (ApplicationMessage.virtual_client_action) {
        case key_package:
          KeyPackage key_package;
          VClientSeedContext seed_context;

        case propsal:
          Proposal proposal
          select (ApplicationMessage.propsal.proposal_type)
            case update:  ReKeySeedContext rekey_seed_context;
          }
      }
  }
} ApplicationMessage
</pre><a href="#section-4.5-3" class="pilcrow">¶</a>
</div>
<p id="section-4.5-4">OPEN QUESTIONS<a href="#section-4.5-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5-5.1">
            <p id="section-4.5-5.1.1">How should clients communicate about VirtClient commits, KPs, proposals, etc. E.g. if Alice creates a new KP for a virt client, what should she send about it the other emulator clients? the entire KP? just its KeyPackageRef? Or the specific parameters used to generate it (capabilities, ciphersuite, extensions,...). Sending entire KP to emulator group (e.g. as an app msgs) could mean better backwards compat with a standard MLS DS. (An MLS DS has no concept of "Give me a KP, but don't pop it from its queue" let alone something like "give me the KP with init_key X" or whatever.) On the other hand sending over whole KP to the emulator group could be very redundant. In many (most?) applications there's likely little to no choice when creating a KP besides sampling keys and the coins for the signature. So sending over the KPID and signatures for a new KP is enough for other emulator clients to reconstruct the entire KP locally for themselves.<a href="#section-4.5-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.5-5.2">
            <p id="section-4.5-5.2.1">Similar question for proposals.<a href="#section-4.5-5.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="adding-and-removing-emulator-clients">
<section id="section-4.6">
        <h3 id="name-adding-and-removing-emulato">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-adding-and-removing-emulato" class="section-name selfRef">Adding and Removing Emulator Clients</a>
        </h3>
<p id="section-4.6-1">Send them the local states of all representativs of G encrypted in their welcome message. No action needs to be taken in any super group.<a href="#section-4.6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="example-protocol-flow">
<section id="section-4.7">
        <h3 id="name-example-protocol-flow">
<a href="#section-4.7" class="section-number selfRef">4.7. </a><a href="#name-example-protocol-flow" class="section-name selfRef">Example protocol flow</a>
        </h3>
<p id="section-4.7-1">TODO: Go through a full flow, where both sender and receiver are virtual
clients. Include both communication in the higher-level group and in the
emulation group.<a href="#section-4.7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="dsas-details">
<section id="section-4.8">
        <h3 id="name-ds-as-details">
<a href="#section-4.8" class="section-number selfRef">4.8. </a><a href="#name-ds-as-details" class="section-name selfRef">DS/AS Details</a>
        </h3>
<p id="section-4.8-1">Virtual client emulation should be largely agnostic to specific details of the
AS and DS of the application. However, a few conditions must be met.<a href="#section-4.8-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.8-2.1">
            <p id="section-4.8-2.1.1">Access control: All emulator clients must be able to act as the virtual
client, including, for example, queue access and KeyPackage upload<a href="#section-4.8-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.8-2.2">
            <p id="section-4.8-2.2.1">Queue compatibility: The queue system must allow all emulator clients to
retrieve messages for the virtual clients. (Although workarounds like one
emulator client retrieving messages and then sending them to the emulation
group are possible.)<a href="#section-4.8-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="agreement-ongeneration-of-key-material">
<section id="section-4.9">
        <h3 id="name-agreement-on-generation-of-">
<a href="#section-4.9" class="section-number selfRef">4.9. </a><a href="#name-agreement-on-generation-of-" class="section-name selfRef">Agreement on/generation of key material</a>
        </h3>
<p id="section-4.9-1">Agreement on key material is one of the primary features of MLS and the emulator
clients can simply export secrets from the emulation group to provide the
randomness for all key material generated by the virtual client throughout its
lifetime, especially any MLS-specific key material such as leaf encryption keys
or init keys.<a href="#section-4.9-1" class="pilcrow">¶</a></p>
<p id="section-4.9-2">This leaves the generation of authentication key material, which can also be
based on exporters from the emulation group, but which otherwise depends on the
design of the AS. In the context of virtual clients, one should note, however,
that the specifics of the AS can influence how well the virtual client hides the
metadata of the underlying emulator clients.<a href="#section-4.9-2" class="pilcrow">¶</a></p>
<p id="section-4.9-3">TODO: Be more explicit on how the randomness is exported.<a href="#section-4.9-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="coordinating-virtual-client-operations">
<section id="section-4.10">
        <h3 id="name-coordinating-virtual-client">
<a href="#section-4.10" class="section-number selfRef">4.10. </a><a href="#name-coordinating-virtual-client" class="section-name selfRef">Coordinating virtual client operations</a>
        </h3>
<p id="section-4.10-1">Generally, emulator clients should coordinate the actions taken by the virtual
client. This is, for example, to prevent multiple emulator clients from
uploading KeyPackages simultaneously.<a href="#section-4.10-1" class="pilcrow">¶</a></p>
<p id="section-4.10-2">However, emulator clients do not have to coordinate all actions taken by the
virtual client. Specifically, commits in a single higher-level group can be sent
without the risk of desynchronization between the emulator clients, as the
group’s DS will enforce message ordering. Coordination is thus required for
non-commit messages (specifically proposals and application messages), as well
as actions that affect more than one higher-level group (such as credential
updates, depending on the AS).<a href="#section-4.10-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="possible-message-re-ordering">
<section id="section-4.11">
        <h3 id="name-possible-message-re-orderin">
<a href="#section-4.11" class="section-number selfRef">4.11. </a><a href="#name-possible-message-re-orderin" class="section-name selfRef">Possible message re-ordering</a>
        </h3>
<p id="section-4.11-1">One difficulty in coordinating the use of randomness exported from the emulation
group is that we cannot assume that messages arrive in order. For example, if an
emulator client sends an Update in the emulation group and then immediately
exports randomness from the new epoch to have the virtual client create an
update in the higher-level group, then other emulator clients might receive the
update in the higher-level group first. Since they have not yet received the
other update, they will have to wait for the emulation group update before they
can process it. Depending on the DS, this may or may not require specific care.<a href="#section-4.11-1" class="pilcrow">¶</a></p>
<p id="section-4.11-2">TODO: Add a recommendation here, maybe to extract randomness only from emulation
group epochs that are at least X seconds old, which in turn requires clients to
keep around randomness, thus potentially compromising FS somewhat.<a href="#section-4.11-2" class="pilcrow">¶</a></p>
<p id="section-4.11-3">In addition, since the epochs in the emulation group and higher level group are
not necessarily correlated, i.e. an emulator client performing an update in the
higher level group might not at the same time perform an update in the emulation
group. The emulator client performing the update in the higher level group thus
has to signal the other emulator clients which emulation group epoch to use to
export the randomness.<a href="#section-4.11-3" class="pilcrow">¶</a></p>
<p id="section-4.11-4">TODO: Find a good way to signal this to the rest of the emulation group. Options:<a href="#section-4.11-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.11-5.1">
            <p id="section-4.11-5.1.1">AAD of the higher-level group update (leaks metadata to higher-level groups,
could collide with application-level use of AAD)<a href="#section-4.11-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.11-5.2">
            <p id="section-4.11-5.2.1">Application message to emulation group (subject to message re-ordering as
described above)<a href="#section-4.11-5.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.11-5.3">
            <p id="section-4.11-5.3.1">LeafNode extension (leaks metadata to higher-level groups)<a href="#section-4.11-5.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="adding-emulator-clients">
<section id="section-4.12">
        <h3 id="name-adding-emulator-clients">
<a href="#section-4.12" class="section-number selfRef">4.12. </a><a href="#name-adding-emulator-clients" class="section-name selfRef">Adding emulator clients</a>
        </h3>
<p id="section-4.12-1">If a client is added to the emulation group, it has to be provisioned with the
private key material and the group states of all higher-level groups. While the
latter might be able to be provisioned by the higher-level DS, the former has to
be provided by another emulator client.<a href="#section-4.12-1" class="pilcrow">¶</a></p>
<p id="section-4.12-2">The other emulator client can provide the secret key material used to derive all
key material relevant to the virtual client (higher-level group secrets,
KeyPackage secrets, etc.)<a href="#section-4.12-2" class="pilcrow">¶</a></p>
<p id="section-4.12-3">TODO: This means that all such key material must be derived in a well-separated
and forward-secure way. (See TODO above to specify further details on how to
derive key material for the virtual client.)<a href="#section-4.12-3" class="pilcrow">¶</a></p>
<p id="section-4.12-4">Since the new emulator client can only emulate the virtual client if it has
access to those secrets, it cannot join the emulation group via external commit,
except if said secrets are provided asynchronously.<a href="#section-4.12-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sending-application-messages">
<section id="section-4.13">
        <h3 id="name-sending-application-message">
<a href="#section-4.13" class="section-number selfRef">4.13. </a><a href="#name-sending-application-message" class="section-name selfRef">Sending application messages</a>
        </h3>
<p id="section-4.13-1">Open Question: Key material for encryption/decryption of application messages is
used only once. Since there is no ordering of application messages (per client)
on the DS, emulator clients could have the same virtual client send an
application message at the same time, both using the same key material. When
those messages arrive at a recipient, the recipient won’t be able to decrypt the
second message, because the recipient has already discarded the required key
material. How to avoid this? A few ideas:<a href="#section-4.13-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.13-2.1">
            <p id="section-4.13-2.1.1">Key generation allotments: Clients in the emulation group use the ratchet
generation modulo their leaf index in the emulation group. (Leaks metadata to
higher-level groups, potentially requires all other higher-level group members
to store lots of intermediary key generations, could confuse applications if
they derive message ordering from key generations, could make recipients think
that they missed messages)<a href="#section-4.13-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.13-2.2">
            <p id="section-4.13-2.2.1">More complex secret tree (or separate secret tree): Instead of a single
ratchet at the leaf of the secret tree, there is another tree with one ratchet
for each emulator client. (extra costs for PPRF, leaks metadata, requires an
extension, either an unsafe one (if the original secret tree is modified), or
a safe one that defines its own application message (if a new secret tree is
used))<a href="#section-4.13-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<div id="pprf-based-challenges">
<section id="section-4.13.1">
          <h4 id="name-pprf-based-challenges">
<a href="#section-4.13.1" class="section-number selfRef">4.13.1. </a><a href="#name-pprf-based-challenges" class="section-name selfRef">PPRF-based Challenges</a>
          </h4>
<p id="section-4.13.1-1">Key/nonce pairs used to encrypt application messages are derived using a PPRF.
That is, the Secret Tree in the super group is replaced by a GGM-style PPRF
initially keyed by the <code>encryption_secret</code>. To send an application messaage,
the sending emulator client choose a 32 byte challenge and includes it in the
<code>authenticated_data</code> field in the <code>PrivateMessage</code> struct. To derive the nonce
and AEAD key for the application message the PPRF is evaluated (and punctured)
the PPRF at the challenge. Due to the entropy in the challenge nonce-reuse
guards can be dropped.<a href="#section-4.13.1-1" class="pilcrow">¶</a></p>
<p id="section-4.13.1-2">Advantages:
- Group Structure Agnostic : The construction is agnostic to all aspects of the
group's membership structure. For example, clients can receive application
messages without knowing the sender's leaf index in it's virtual client nor
the relative position of the sender's virtual client in the hiearchy of virtual
clients making up the super group.
- Metadata Hiding: The scheme hides everything about a sender's position in the
groups membership heirachy beyond what is revealed by the signature. For
example, application messages are as unlinkabel as permited by their signatures
(even for other emulation clients in the same virtual client).
- Forward Security Sender Anonymity : Leaking a clients PPRF local state reveals
nothing about who sent previously received application messages. This includes
both hiding both the sending emulation clients and even their virtual clients.<a href="#section-4.13.1-2" class="pilcrow">¶</a></p>
<p id="section-4.13.1-3">Disadvantages:
- Breaks the RFC9420 specification &amp; requires an un-safe extension.
- Applications messages have an added 28 byte overhead.
- Senders need 28 additional random bytes to send an application message.
- A decryption error occurs when receiving an application message with a
previously used challenge (in the current epoch).<a href="#section-4.13.1-3" class="pilcrow">¶</a></p>
<p id="section-4.13.1-4">There is a trade-off between cost and error probability when choosing <code>b</code>; the
bit-length of challenges. (Above <code>b = 256</code> which is very conservative.)
- Sending two application messages with the same challenge in an epoch
immediatly leaks the XOR of the two plaintexts and results in decryption
failures for which ever message a client receives second. The probability a
challenge gets re-used when <code>k</code> application messages with <code>b</code>-bit challenges
are sent in an epoch (without any coordination) is
<code>err = 1-[C(2^b,k)/C(2^b+k-1)]</code>. So larger <code>b</code> reduces the probability of
challenge re-use exponentially.
- Evaluating the PPRF requires up to <code>b</code> HKDF calls and new 32B values to be
stored locally by the client. Moreover, <code>b</code>-bit challenges impost a <code>8b-4</code> bytes
of overhead in application messages and added random bits when sending.<a href="#section-4.13.1-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="rotation-of-authentication-key-material">
<section id="section-4.14">
        <h3 id="name-rotation-of-authentication-">
<a href="#section-4.14" class="section-number selfRef">4.14. </a><a href="#name-rotation-of-authentication-" class="section-name selfRef">Rotation of authentication key material</a>
        </h3>
<p id="section-4.14-1">If the design of the AS specifies the use of cross-group authentication key
material, emulator clients must coordinate the rotation of said key material in
the emulation group to avoid multiple emulator clients rotating a key at the
same time. Details depend on the design of the AS.<a href="#section-4.14-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-5">
      <h2 id="name-security-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-security-considerations" class="section-name selfRef">Security considerations</a>
      </h2>
<p id="section-5-1">TODO: Detail security considerations once the protocol has evolved a little
more. Starting points:<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">Some of the performance benefits of this scheme depend on the fact that one can
update once in the emulation group and “re-use” the new randomness for updates
in multiple higher-level groups. At that point, clients only really recover when
they update the emulation group, i.e. re-using somewhat old randomness of the
emulation group won’t provide real PCS in higher-level groups.<a href="#section-5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="privacy-considerations">
<section id="section-6">
      <h2 id="name-privacy-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-privacy-considerations" class="section-name selfRef">Privacy considerations</a>
      </h2>
<p id="section-6-1">TODO: Specify the metadata hiding properties of the protocol. The details depend
on how we solve some of the problems described throughout this document.
However, using a virtual client should mask add/remove activity in the
underlying emulation group. If it actually hides the identity of the members may
depend on the details of the AS, as well as how we solve the application
messages problem.<a href="#section-6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="performance-considerations">
<section id="section-7">
      <h2 id="name-performance-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-performance-considerations" class="section-name selfRef">Performance considerations</a>
      </h2>
<p id="section-7-1">There are several use cases, where a specific group of clients represents a
higher-level entity such as a user, or a part of an organization. If that group
of clients shares membership in a large number of groups, where its sole purpose
is to represent the higher-level entity, then instead emulating a virtual client
can yield a number of performance benefits, especially if this strategy is
employed across an implementation. Generally, the more emulator clients are
hidden behind a single virtual client and the more clients are replaced by
virtual clients, the higher the potential performance benefits.<a href="#section-7-1" class="pilcrow">¶</a></p>
<div id="smaller-trees">
<section id="section-7.1">
        <h3 id="name-smaller-trees">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-smaller-trees" class="section-name selfRef">Smaller Trees</a>
        </h3>
<p id="section-7.1-1">As a general rule, groups where one or more sets of clients are replaced by
virtual clients have fewer members, which leads to cheaper MLS operations where
the cost depends on the group size, e.g., commits with a path, the download size
of the group state for new members, etc. This increase in performance can offset
performance penalties, for example, when using a PQ-secure cipher suite, or if
the application requires high update frequencies (deniability).<a href="#section-7.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="fewer-blanks">
<section id="section-7.2">
        <h3 id="name-fewer-blanks">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-fewer-blanks" class="section-name selfRef">Fewer blanks</a>
        </h3>
<p id="section-7.2-1">Blanks are typically created in the process of client removals. With virtual
clients, the removal of an emulator client will not cause the leaf of the
virtual client (or indeed any node in the virtual client’s direct path) to be
blanked, except if it is the last remaining emulator client. As a result,
fluctuation in emulator clients does not necessarily lead to blanks in the group
of the corresponding virtual clients, resulting in fewer overall blanks and
better performance for all group members.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="emulation-costs">
<section id="section-8">
      <h2 id="name-emulation-costs">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-emulation-costs" class="section-name selfRef">Emulation costs</a>
      </h2>
<p id="section-8-1">From a performance standpoint, using virtual clients only makes sense if the
performance benefits from smaller trees and fewer blanks outweigh the
performance overhead incurred by emulating the virtual client in the first
place.<a href="#section-8-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Konrad Kohbrok</span></div>
<div dir="auto" class="left"><span class="org">Phoenix R&amp;D</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:konrad.kohbrok@datashrine.de" class="email">konrad.kohbrok@datashrine.de</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Raphael Robert</span></div>
<div dir="auto" class="left"><span class="org">Phoenix R&amp;D</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ietf@raphaelrobert.com" class="email">ietf@raphaelrobert.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
